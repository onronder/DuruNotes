# Baseline Schema Validation â€“ 2025-03-01 Dry Run

**Context**  
Dry run of `supabase/migrations/20250301000000_initial_baseline_schema.sql` against a disposable PostgreSQL 15 container to prove the baseline applies cleanly and that the validation script succeeds.

**Setup**
- Image: `postgres:15`
- Database: `duru`
- Seeded Supabase stubs:
  - `auth.users` table (minimal columns)
  - `auth.uid()` helper returning a fixed UUID (required for RLS policies during local dry runs)

**Commands**
```bash
# 1. Apply baseline migration
docker exec -i supabase-dryrun \
  psql -U postgres -d duru -v ON_ERROR_STOP=1 \
  -f - < supabase/migrations/20250301000000_initial_baseline_schema.sql

# 2. Run validation checklist
docker exec -i supabase-dryrun \
  psql -U postgres -d duru -v ON_ERROR_STOP=1 \
  -f - < supabase/validation/check_baseline.sql
```

**Key Results**
- All 26 expected tables created (`notes`, `folders`, `notification_events`, `user_profiles`, etc.).
- RLS policies confirmed present via `pg_policies.policyname` for each table.
- Required helper functions (`set_updated_at`, `user_devices_upsert`, `should_send_notification`, `generate_user_alias`, `create_notification_event`, `notification_preferences_increment_daily`) available in the `public` schema.
- No errors after updating the validation script to use `policyname` (Postgres 10+).

**Notes**
- Local dry runs must create the stub `auth` schema and `auth.uid()` helper before applying the migration. See `docs/SUPABASE_RUNBOOK.md` for the exact commands.
