# 2025-10-21 – Stabilization Updates

## Completed Work
- Restored note list ordering by sorting combined results from pagination on `updatedAt` and de-duplicating note IDs so the most recently saved note always appears first (`NotesPaginationNotifier`).
- Reworked inbox badge tracking to persist read inbox item IDs locally, count only unopened items, and update as soon as an item is viewed, converted, or deleted (`InboxUnreadService`, `InboundEmailInboxWidget`).
- Added simulator detection and clearer error handling in `PushNotificationService` so FCM registration reports actionable reasons (simulator vs. real device) and no longer loops on silent failures.
- Hardened `send-push-notification` edge function by removing the invalid `.catch` usage; the function now returns proper success responses when logging delivery results to `notification_events`.
- Verified FCM token registration on physical iOS devices end-to-end (token retrieval, Supabase RPC upsert, database verification).
- Instrumented note creation path with additional logging in `ModernEditNoteScreen` and `NotesCoreRepository.createOrUpdate` to capture null returns and unauthenticated writes ahead of investigating the creation regression.
- Removed the stale cache-invalidation listener in `notesPageProvider`; it was failing because the domain repository no longer exposes `cacheInvalidationStream`.
- Instrumented reminders (`ReminderCoordinator`), tasks (`DomainTaskController`), and template creation (`UnifiedTemplateService`) with debug prints so we can trace creation flows during regression testing.
- Inbox badge now filters processed items, reminder scheduling shares a single notifications bootstrap, the synthetic “Standalone Tasks” container is hidden from user lists, and Supabase migrations were added to guarantee `note_tasks`/`reminders` exist post-migration.
- Restored legacy note decryption (attachments/titles), migrated the standalone task container to a UUID-safe id, re-enqueued affected tasks, and brought pinned-note sorting back to the top of pagination results.

## Outstanding Observations
- Creating a new note currently fails silently (no logs yet). Needs investigation of the entire note creation flow (UI → repository → Supabase sync).
- Inbox badge now reflects opened items but requires sustained validation with real inbound traffic.
- Edge functions are deployed with the latest fixes; further monitoring recommended to ensure no additional 500s surface in logs.
